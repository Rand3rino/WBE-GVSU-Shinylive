[{"name":"app.R","content":"\r\n\r\nlibrary(shiny)\r\nlibrary(tidyverse)\r\nlibrary(plotly)\r\n\r\n# N1 Counts, weighted average by flow per day\r\noptions(scipen = 999)\r\nN1counts <- read.csv(\"https://docs.google.com/spreadsheets/d/13LVOMwdBmBEYLrLYP0GgrSMTHuglqYM7yBdZ5RrEKAs/gviz/tq?tqx=out:csv;outFileName:data&sheet=DataExport\")\r\nN1counts$Date <- as.Date(as.character(N1counts$Date.min.), format = \"%m/%d/%Y\")\r\n# N1 <- N1counts %>%\r\n#         group_by(Date) %>%\r\n#         summarise( N1 = mean(Weighted.N.Count..quotient.sum.sum..))\r\n\r\n\r\n# https://matrixify-excelify.medium.com/download-specific-google-sheets-tab-as-csv-file-e805ecef29fc\r\n# VariantProportions <- read.csv(\"https://docs.google.com/spreadsheets/d/19sCocxxppFfBrM0AKEojOzWoN6C6myoZjIA492deetc/export?format=csv\")\r\nVariantProportions <- read.csv(\"https://docs.google.com/spreadsheets/d/1fDYNLol8WdsZkgQih2wnnOnT6QEVhB7X/gviz/tq?tqx=out:csv;outFileName:data&sheet=DataExport\")\r\ncolnames(VariantProportions) <- paste(colnames(VariantProportions), match(colnames(VariantProportions), colnames(VariantProportions)), sep=\"_\")\r\nVariantProportions <- VariantProportions %>%\r\n  pivot_longer(!Date.by.Week_1, names_to = \"Variant\", values_to = \"Proportion\", values_drop_na = TRUE)\r\nVariantProportions$Week <- as.Date(VariantProportions$Date.by.Week_1, format =\"%m/%d/%Y\")\r\nVariantProportions <- separate_wider_delim(VariantProportions, Variant, delim = \"_\", names = c(\"Variant\", \"Appearance\"))\r\nVariantProportions$Appearance <- as.integer(VariantProportions$Appearance)\r\nVariantProportions <- VariantProportions[order(VariantProportions$Appearance),]\r\nVariantProportions$Variant <- factor(VariantProportions$Variant, levels=unique(VariantProportions$Variant))\r\nVariantProportions <- select(VariantProportions, -Variant)\r\n\r\nVariantColors <- read.csv(\"https://docs.google.com/spreadsheets/d/1fDYNLol8WdsZkgQih2wnnOnT6QEVhB7X/gviz/tq?tqx=out:csv;outFileName:data&sheet=ColorKey\")\r\nVariantColors$Variant <- factor(VariantColors$Variant, levels=unique(VariantColors$Variant))\r\nVariantColors$HexCode <- toupper(VariantColors$HexCode)\r\nVariantColors$Appearance <- 2:(nrow(VariantColors)+1)\r\nVariantProportions <- left_join( VariantProportions, VariantColors, by=\"Appearance\")\r\n\r\nN1counts <- filter(N1counts, max(VariantProportions$Week) >= N1counts$Date)\r\n\r\n\r\n# # Define UI for application that draws a line chart\r\nui <- fluidPage(\r\n  \r\n    \r\n    mainPanel(\r\n      \r\n      # Application Title\r\n      titlePanel(h2(\"COVID-19 Wastewater Based Epidemiology\", align = \"center\")),\r\n      \r\n      # Description\r\n      p(\"Wastewater-based epidemiology (WBE) is an important tool to monitor pathogenic agents that are present in feces (such as SARS-CoV-2).\", align=\"center\"),\r\n      p(\"Students and staff of the GVSU Molecular Monitoring lab have collected data from wastewater samples in Kent County.\", align=\"center\"),\r\n      p(\"Over time, we've detected changes to the variants of COVID-19 in wasterwater.\", align=\"center\"),\r\n      \r\n      \r\n      # Plots\r\n      # plotlyOutput(\"N1Plot\"),\r\n      titlePanel(h4(\"N1 Counts Over Time\", align=\"center\")),\r\n      plotOutput(\"N1Plot\"),\r\n      checkboxInput('hide_points', \"Hide Points: N1 Counts\", value = FALSE),\r\n      titlePanel(h4(\"Variant Proportions - Weekly\", align = \"center\")),\r\n      plotlyOutput(\"VariantPlot\"),\r\n      \r\n      # Variant Proportions Help\r\n      p(\"There are two hover modes to inspect the variants, single or compare. This is found in the upper right corner of the visual.\", align=\"center\"),\r\n      p(\"Double click a variant in the legend to see only that variant, then single click another to add it to the view.\", align=\"center\"),\r\n      p(\"Double click any variant to return to the full view.\", align=\"center\")\r\n      \r\n    )\r\n)\r\n\r\n# # Define server logic required to draw a line chart\r\nserver <- function(input, output) {\r\n  \r\n  # output$N1Plot <- renderPlotly({\r\n  #   ggplotly((ggplot(N1, aes(x=Date, y=N1))\r\n  #      + geom_point()\r\n  #      + geom_smooth()\r\n  #      + theme_bw()\r\n  #      + scale_y_log10()\r\n  #      + ylab(\"Log (N1 Counts)\")\r\n  #      # + ggtitle(\"N1 Counts over Time (Log Scale)\", )\r\n  #      + theme(plot.title = element_text(hjust = 0.5)))\r\n  #   )\r\n  # })\r\n\r\n  output$VariantPlot <- renderPlotly({         \r\n    p<-ggplotly((ggplot(VariantProportions, aes(x=Week, y=Proportion))\r\n      + scale_fill_identity(name = \"Variants\", labels=levels(VariantProportions$Variant), guide=\"legend\")\r\n      + geom_col(aes(fill=HexCode, group=Variant))\r\n      + theme_bw()\r\n      + scale_y_continuous(labels = scales::percent) # Y-Axis as percents\r\n      + scale_x_date(breaks = unique(VariantProportions$Week))\r\n      + xlab(\"Date\")\r\n      + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))\r\n      # + ggtitle(\"Variants over Time as Proportions\")\r\n      + theme(plot.title = element_text(hjust = 0.5))\r\n    )) %>% layout(legend = list(orientation = \"h\", y =-.6), xaxis = list(autorange = TRUE), yaxis = list(autorange = TRUE)) # Auto scale\r\n\r\n    \r\n    for (i in 1:nrow(VariantColors)) {\r\n      p$x$data[[i]]$name <- VariantColors$Variant[VariantColors$HexCode==p$x$data[[i]]$name]\r\n    }\r\n    \r\n    p %>% config(displayModeBar = TRUE, displaylogo=FALSE, modeBarButtonsToRemove = c(\"zoom2d\", \"pan2d\", \"select2d\", \"lasso2d\", \"zoomIn2d\", \"zoomOut2d\"))\r\n  })\r\n  \r\n  output$N1Plot <- renderPlot({\r\n    if (input$hide_points) {\r\n      (\r\n        ggplot(N1counts, aes(x = Date, y = Weighted.N.Count..quotient.sum.sum..)) + geom_smooth(se=F) + theme_bw() + theme(axis.text=element_text(angle=90, size=11), axis.title = element_text(size = 13, margin = margin(r=20),face=\"bold\")) + scale_x_date(expand =c(0,0), date_breaks  =\"1 month\") + ylab(\"N1 Counts\") + theme(plot.title = element_text(hjust = 0.5))\r\n      )\r\n    }\r\n    else {\r\n      (\r\n        ggplot(N1counts, aes(x = Date, y = Weighted.N.Count..quotient.sum.sum..)) + geom_point() + geom_smooth(se=F) + theme_bw() + theme(axis.text=element_text(angle=90, size=11), axis.title = element_text(size = 12, face=\"bold\"), axis.title.y = element_text(angle=0)) + scale_x_date(expand =c(0,0), date_breaks  =\"1 month\") + ylab(\"N1Count\") + theme(plot.title = element_text(hjust = 0.5))\r\n        # + ggtitle(\"N1 Counts over Time (Log Scale)\", )+theme(plot.title = element_text(hjust = 0.5))\r\n      )\r\n    }\r\n  })\r\n    \r\n  # \r\n  # output$VariantPlot <- renderPlot({\r\n  #   ggplot(VariantProportions, aes(x=Date.by.Week, y=Proportion)) + geom_col(aes(fill=Variant)) + theme_bw() + theme(legend.position = \"bottom\")\r\n  # })\r\n}\r\n\r\n# Run the application \r\nshinyApp(ui = ui, server = server)\r\n\r\n\r\n#shinylive::export(\"WBE-Analysis\", \"docs\")\r\n#httpuv::runStaticServer(\"docs\")","type":"text"},{"name":"WBEapp.R","content":"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n## https://debruine.github.io/shinyintro/data.html\r\n# update.packages(ask = F) # https://stackoverflow.com/questions/68451929/shiny-apps-not-running-hanging-not-working\r\n# library(shiny)\r\n# library(shinylive)\r\n# library(tidyverse)\r\n# library(plotly)\r\n# library(googlesheets4)\r\n# gs4_deauth()\r\n# sheet_id <- \"https://docs.google.com/spreadsheets/d/1Y8HZf93GiC_8XjK7nxqZONcTmi4Ck7EH96hR4q6Kbio\"\r\n# N1counts <- read_sheet(sheet_id)\r\n# N1counts$Date <- as.Date(as.character(N1counts$Date), \"%y%m%d\")\r\n# \r\n# # Define UI for application that draws a line chart\r\nui <- fluidPage(\r\n\r\n    # Application title\r\n    titlePanel(\"WBE-Analysis\"),\r\n\r\n    # Sidebar with a dropdown for number site\r\n    sidebarLayout(\r\n        sidebarPanel(\r\n          selectInput(\"SiteSelect\",\r\n                        \"Select Site to view\",\r\n                        choices = c(\"CS\", \"GG\", \"GO\", \"GR\", \"WB\", \"WK\", \"WY\"))\r\n        ),\r\n\r\n        # Show a plot of the n1 counts\r\n        mainPanel(\r\n           plotOutput(\"N1Plot\")\r\n        )\r\n    )\r\n)\r\n# \r\n# # Define server logic required to draw a line chart\r\n server <- function(input, output) {\r\n \r\n     output$N1Plot <- renderPlot({\r\n         N1Site <- N1counts %>% filter(Site == input$SiteSelect)\r\n         ggplot(N1Site, aes(x=Date, y=`N1 GC/100mL`)) + geom_line() + geom_point() + theme_bw()\r\n     })\r\n }\r\n\r\n # Run the application \r\n shinyApp(ui = ui, server = server)\r\n","type":"text"}]
